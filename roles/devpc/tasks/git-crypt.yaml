---
# Install git-crypt

- name: Check if git-crypt installed
  shell: command -v git-crypt >/dev/null 2>&1
  register: gitcrypt_exists
  ignore_errors: yes
  changed_when: false

- debug:
    msg: "gitcrypt_exists = {{ gitcrypt_exists }}"

- apt:
    name:
      - make
      - g++
      - libssl-dev
      - openssl
    state: present
  when: gitcrypt_exists.changed


- shell: git clone https://github.com/AGWA/git-crypt.git  
  args:
    chdir: "{{ my_home }}/Downloads"
    creates: "{{ my_home }}/Downloads/git-crypt"
  when: gitcrypt_exists.changed


- shell: "make; make install PREFIX=/usr/local"
  args:
    chdir: "{{ my_home }}/Downloads/git-crypt"
  when: gitcrypt_exists.changed


- file:
    path: "{{ my_home }}/Downloads/git-crypt"
    state: absent